<!-- Верхняя панель -->
<div class="main-header">
    <!-- Левая часть -->
    <div class="header-left">
        <!-- Кнопка мобильного меню -->
        <button class="btn-icon mobile-menu-toggle d-md-none">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Заголовок страницы -->
        <h1 class="page-title">
            {% block page_title %}
                {% if request.resolver_match.url_name == 'dashboard' %}
                    Главная
                {% elif 'orders' in request.path %}
                    Заказы
                {% elif 'clients' in request.path %}
                    Клиенты
                {% elif 'services' in request.path %}
                    Услуги
                {% elif 'employees' in request.path %}
                    Сотрудники
                {% elif 'finances' in request.path %}
                    Финансы
                {% else %}
                    CRM
                {% endif %}
            {% endblock %}
        </h1>
    </div>

    <!-- Правая часть -->
    <div class="header-actions">
        <!-- Поиск -->
        <div class="search-container">
            <div class="search-input-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Поиск..." data-target=".searchable-item">
            </div>
        </div>

        <!-- Уведомления -->
        <div class="dropdown">
            <button class="btn-icon dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" style="display: none;">0</span>
            </button>
            <div class="dropdown-menu dropdown-menu-end notification-dropdown">
                <div class="dropdown-header">
                    <h6>Уведомления</h6>
                    <button class="btn btn-sm btn-outline-primary">Отметить все</button>
                </div>
                <div class="notification-list">
                    <!-- Уведомления будут загружаться через AJAX -->
                    <div class="notification-item">
                        <div class="notification-content">
                            <div class="notification-text">
                                <strong>Новый заказ #1234</strong>
                                <p>Клиент: ООО "Рога и Копыта"</p>
                            </div>
                            <div class="notification-time">5 мин назад</div>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item text-center">
                        Показать все уведомления
                    </a>
                </div>
            </div>
        </div>

        <!-- Быстрые действия -->
        {% if is_manager %}
        <div class="dropdown">
            <button class="btn-icon dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-plus"></i>
            </button>
            <div class="dropdown-menu dropdown-menu-end">
                <a class="dropdown-item" href="#" data-modal-url="{% url 'order_create_modal' %}" data-modal-title="Создать заказ" data-modal-size="xl">
                    <i class="fas fa-clipboard-list"></i> Новый заказ
                </a>
                <a class="dropdown-item" href="#" data-modal-url="{% url 'client_create_modal' %}" data-modal-title="Добавить клиента" data-modal-size="lg">
                    <i class="fas fa-user-plus"></i> Новый клиент
                </a>
                <a class="dropdown-item" href="#" data-modal-url="{% url 'service_create_modal' %}" data-modal-title="Добавить услугу" data-modal-size="lg">
                    <i class="fas fa-cogs"></i> Новая услуга
                </a>
                {% if is_owner %}
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" data-modal-url="{% url 'employee_create_modal' %}" data-modal-title="Добавить сотрудника" data-modal-size="lg">
                    <i class="fas fa-user-tie"></i> Новый сотрудник
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Профиль пользователя -->
        <div class="dropdown">
            <div class="user-menu dropdown-toggle" data-bs-toggle="dropdown">
                <div class="user-avatar">
                    {{ user.first_name.0|default:user.username.0|upper }}
                </div>
                <div class="user-info">
                    <h6>{{ user.get_full_name|default:user.username }}</h6>
                    <small>{{ company_user.get_role_display }}</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="dropdown-menu dropdown-menu-end user-dropdown">
                <div class="dropdown-header">
                    <div class="user-details">
                        <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                        <div class="user-email">{{ user.email }}</div>
                        <div class="company-badge">{{ current_company.name }}</div>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                
                <a class="dropdown-item" href="#" data-modal-url="{% url 'user_profile_modal' %}" data-modal-title="Мой профиль" data-modal-size="lg">
                    <i class="fas fa-user"></i> Мой профиль
                </a>
                
                <a class="dropdown-item" href="{% url 'my_salary' %}">
                    <i class="fas fa-wallet"></i> Моя зарплата
                    {% if user_unpaid_salary %}
                        <span class="badge badge-warning ms-auto">{{ user_unpaid_salary|floatformat:0 }}₽</span>
                    {% endif %}
                </a>
                
                <div class="dropdown-divider"></div>
                
                <a class="dropdown-item" href="{% url 'company_select' %}">
                    <i class="fas fa-building"></i> Сменить компанию
                </a>
                
                {% if is_owner %}
                <a class="dropdown-item" href="{% url 'company_settings' %}">
                    <i class="fas fa-cog"></i> Настройки компании
                </a>
                {% endif %}
                
                <div class="dropdown-divider"></div>
                
                <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.header-left {
    display: flex;
    align-items: center;
    gap: 16px;
}

.search-container {
    position: relative;
    margin-right: 16px;
}

.search-input-wrapper {
    position: relative;
    width: 300px;
}

.search-input {
    width: 100%;
    padding: 8px 16px 8px 40px;
    border: 1px solid var(--border-color);
    border-radius: 20px;
    font-size: 0.875rem;
    background: var(--light-color);
    transition: all 0.2s ease;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    background: white;
    box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
}

.search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 0.875rem;
}

.notification-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--danger-color);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.625rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

.notification-dropdown {
    width: 350px;
    max-height: 400px;
    overflow-y: auto;
}

.notification-list {
    max-height: 300px;
    overflow-y: auto;
}

.notification-item {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s ease;
}

.notification-item:hover {
    background-color: var(--light-color);
}

.notification-item:last-child {
    border-bottom: none;
}

.notification-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.notification-text strong {
    font-size: 0.875rem;
    color: var(--text-primary);
}

.notification-text p {
    margin: 4px 0 0 0;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.notification-time {
    font-size: 0.625rem;
    color: var(--text-muted);
    white-space: nowrap;
    margin-left: 8px;
}

.user-dropdown {
    width: 280px;
}

.user-details {
    padding: 8px 0;
}

.user-name {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.user-email {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.company-badge {
    display: inline-block;
    background: rgba(66, 133, 244, 0.1);
    color: var(--primary-color);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.625rem;
    font-weight: 500;
}

.dropdown-header {
    padding: 12px 16px;
    background: var(--light-color);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dropdown-header h6 {
    margin: 0;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
}

.text-danger {
    color: var(--danger-color) !important;
}

/* Адаптивность */
@media (max-width: 768px) {
    .search-input-wrapper {
        width: 200px;
    }
    
    .notification-dropdown,
    .user-dropdown {
        width: 280px;
    }
    
    .page-title {
        font-size: 1.25rem;
    }
}

@media (max-width: 576px) {
    .search-container {
        display: none;
    }
    
    .header-actions {
        gap: 8px;
    }
    
    .user-info {
        display: none;
    }
}
</style>